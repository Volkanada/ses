<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Reklam Kaşesi Hesaplama</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.7">
  <style type="text/css">
    body {
        font-family: Helvetica, sans-serif;
        padding: 10px;
        max-width: 1200px;
        margin: auto;
    }
    h1, h3 { color: #333; }
    h5 { margin: 0; }
    label { display: block; margin: 10px 0; }
    input { 
        margin: 5px 0; 
        padding: 8px; 
        outline: none;
    }
    #anaFilmAdi, #versiyonAdi { 
        max-width: 300px;
    }
    #anaFilmSure, #versiyonSure { 
        max-width: 60px;
    }
    button {
        padding: 8px 16px;
        margin: 10px 5px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 14px;
    }
    button:hover { background-color: #45a049; }
    button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }
    #resetButton, #geriButton, #versiyonYokButton { background-color: #2a76a7; }
    #resetButton:hover, #geriButton:hover, #versiyonYokButton:hover { background-color: #d32f2f; }
    .section { margin-bottom: 20px; }
    #summaryBox {
        border: 2px solid #333;
        padding: 20px;
        background-color: #f9f9f9;
        margin-bottom: 20px;
    }
    .hidden { display: none; }
    .mecra-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 20px;
    }
    .mecra-button {
        padding: 6px 12px;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 14px;
    }
    .mecra-button.selected {
        background-color: #4CAF50;
        color: white;
    }
    .mecra-button:disabled {
        background-color: #f0f0f0;
        color: #ccc;
        cursor: not-allowed;
    }
    .versiyon-sayisi-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }
    .versiyon-sayisi-container input {
        width: 60px;
        padding: 6px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    .toplam-kase {
        background-color: yellow;
        padding: 5px;
        font-weight: bold;
    }
    .ana-film-summary { color: #1a73e8; }
    .versiyon-summary { color: #0288d1; }
    .genel-bilgiler {
        margin-top: 20px;
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    .genel-bilgiler h4 { margin-top: 0; color: #333; }
    .genel-bilgiler p { margin: 5px 0; font-size: 14px; }
    #alertBox {
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translate(-50%, 0);
        background-color: rgba(0, 255, 0, 0.2);
        border: 2px solid rgba(0, 100, 0, 0.5);
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 100, 0, 0.3);
        z-index: 1000;
        text-align: center;
        color: #333;
    }
    .extra-mecra { color: red; }
    .archive-entry {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        background-color: #fff;
    }
    #finalActions {
        margin-top: 20px;
        text-align: center;
    }
    @media only screen and (max-width: 768px) {
        button {
            padding: 12px 24px;
            font-size: 18px;
        }
        .mecra-button {
            padding: 10px 18px;
            font-size: 16px;
        }
        input {
            padding: 10px;
            font-size: 16px;
        }
        #anaFilmAdi, #versiyonAdi {
            max-width: 250px;
        }
        #anaFilmSure, #versiyonSure {
            max-width: 80px;
        }
        .versiyon-sayisi-container input {
            width: 80px;
        }
    }
  </style>
</head>
<body>
    <div id="summaryBox">
        <h3>Hesaplama Özeti</h3>
        <div id="archiveEntries"></div>
        <p id="summaryText"></p>
        <button id="kopyalaButton" class="hidden" onclick="kopyalaOzet()">Kopyala</button>
        <div id="restartSection" class="hidden">
            <button id="restartButton" onclick="location.reload()">Baştan Başla</button>
        </div>
    </div>

    <div class="selection-container" id="selectionContainer">
        <p>Reklam Kaşesi Hesaplama Modülüne Hoş Geldiniz. Lütfen Seçimlerinizi Yapınız。</p>

        <div class="section">
            <label for="anaFilmAdi"><b>Ana Film Bilgileri</b></label>
            <input type="text" id="anaFilmAdi" placeholder="Ana Film Adı (Opsiyonel)">
            <input type="text" id="anaFilmSure" placeholder="Süre (Opsiyonel, örn: 20)">
            <label for="anaFilmMecraOptions"><b>Ana Film için Mecra Seçimi</b></label>
            <div class="mecra-container" id="anaFilmMecraOptions">
                <div class="mecra-button" data-value="tv">TV</div>
                <div class="mecra-button" data-value="dijital">Dijital</div>
                <div class="mecra-button" data-value="sm">Sosyal Medya</div>
                <div class="mecra-button" data-value="karasal_radyo">Karasal Radyo</div>
                <div class="mecra-button" data-value="dijital_radyo">Dijital Radyo</div>
                <div class="mecra-button" data-value="sinema">Sinema</div>
                <div class="mecra-button" data-value="indoor">Indoor</div>
                <div class="mecra-button" data-value="outdoor">Outdoor</div>
                <div class="mecra-button" data-value="metaverse">Metaverse</div>
            </div>
            <button id="anaFilmOnaylaButton" onclick="handleAnaFilmMecraSelection()">Ana Film Mecralarını Onayla</button>
        </div>

        <div id="versiyonSection" class="hidden">
            <h4>Versiyon Bilgileri:</h4>
            <div class="versiyon-sayisi-container">
                <label>Versiyon Sayısı Girin:</label>
                <input type="number" id="versiyonSayisi" min="1" max="200" value="1">
            </div>
            <button id="devamEtButton" onclick="showVersiyonMecraOptions()">Versiyon Ekle</button>
            <button id="versiyonYokButton" onclick="skipVersiyon()">Versiyon Yok</button>
        </div>

        <div id="versiyonMecraSection" class="hidden">
            <h5 id="versiyonBaslik"></h5>
            <input type="text" id="versiyonAdi" placeholder="Versiyon Adı (Opsiyonel)">
            <input type="text" id="versiyonSure" placeholder="Süre (Opsiyonel, örn: 20)">
            <div class="mecra-container" id="versiyonMecraOptions"></div>
            <button id="versiyonEkleButton" onclick="addVersiyon()">1. Versiyonu Ekle</button>
        </div>

        <div id="finalActions" class="hidden">
            <button id="archiveAndResetButton" onclick="archiveAndReset()">Hesaplamayı Özete Ekle ve Yeni Hesap Yap</button>
            <button id="finishButton" onclick="finishCalculation()">Özete Ekle ve Hesaplamayı Bitir</button>
            <button id="fullResetButton" onclick="resetAll()">Tümünü Sıfırla</button>
        </div>
    </div>

    <div id="alertBox" class="hidden">Tıklayınca kapanır。</div>

    <div class="genel-bilgiler">
        <h4>Genel Bilgiler</h4>
        <p><strong>NASIL KULLANILIR?</strong></p>
        <p>Öncelikle İlk Yayına çıkacak ANA FİLM'iniz için MECRA seçimi yapınız, ardından ANA FİLM MECRALARINI ONAYLAYIN. Sonrasında VERSİYONlarınız varsa sayısını girin ve her biri için MECRALARI seçiniz ve sırayla ekleyiniz. Son Versiyonunuzun Mecralarını da girdiğinizde Hesaplama Özeti Kutusunda Detaylı Özet ve TOPLAM KAŞE hesabını görebilirsiniz. Eğer Birden fazla Ana Filminiz varsa, Ana Film hesabıyla çarpmalısınız。</p>
        <br><br>
        <p><strong>ANA FİLM NEDİR?</strong></p>
        <p>Reklam kampanyasının ilk yayına çıkan/çıkacak filmidir. Uzun Film, Asıl Kopya, Ana Kopya da denilir. Radyo Spotu ise İlk Spot sayılır。 </p>
        <br><br>
        <p><strong>VERSİYON NEDİR?</strong></p>
        <p>Aynı yayın yılı içerisinde ürün ve marka sabit kalmak koşuluyla reklam filmine yeni planların eklenmesi, çıkarılması, KISASI kesilmesi, aynı ürünün değişik çeşitlerinin gösterilmesi, filme yeni seslendirme ve yeni yazı planlarıyla ek yapılması, ana filmin süresi kısaltılarak yayınlanması, sanatçının gitmesine gerek kalmadan yapılan her türlü değişiklik ve ek mecra (radyo, sinema, internet, otobüs, uçak, konser, Açıkhava gösterimi, havaalanı, fuar, market, atm, led ekran, mobile, ve sair) yoluyla ticari kazanç elde etme amacına yönelik kullanımlar, versiyon olarak tanımlanır。</p>
        <br><br>
        <p><strong>MECRALAR:</strong></p>
        <p><strong>TV:</strong> Karasal TV yayını yapan tüm televizyon kanalları</p>
        <p><strong>Dijital:</strong> YouTube, kendi web sitesindeki arşiv bölümü hariç tüm web site kullanımları, Haber-Bülten siteleri, PayTV, VoD, e-Ticaret siteleri, Mobil Uygulamalar vb. dahil mecralar</p>
        <p><strong>Sosyal Medya:</strong> Facebook, Instagram, Twitter, TikTok vb。</p>
        <p><strong>Karasal Radyo:</strong> Karasal Yayın Yapan Radyo İstasyonları</p>
        <p><strong>Dijital Radyo:</strong> Dijital Yayın Yapan Radyo İstasyonları</p>
        <p><strong>Sinema:</strong> Sinema Salonları</p>
        <p><strong>Indoor:</strong> Otobüs & Uçak İçi, Havaalanı, Market, Kapalı Fuar & Etkinlik Alanı vb. kapalı yerlerdeki kullanımlar</p>
        <p><strong>Outdoor:</strong> ATM, Konser, Stadyum, Açık Hava Gösterimi, Açık Fuar Alanı vb. açık alandaki kullanımları ifade eder。</p>
        <p><strong>Metaverse:</strong> Sanal Evrenleri Kapsar</p>
        <br><br>
        <p><strong>KULLANIM SÜRESİ:</strong></p>
        <p>Reklam filmleri için belirlenen ücret fatura tarihinden itibaren 1 yıl için geçerlidir. 1 yılın bitiminde reklamın yayınına devam edilmesi halinde yeni yayın yılındaki ücretiyle, yayınlananların işlerin kaşe hesapları %100 olarak yapılır。</p>
        <br><br>
        <p><strong>REKLAM DIŞI İŞLER:</strong></p>
        <p>60 saniye (1 dakika)’yı geçen reklam filmleri 2 kaşe olarak değerlendirilir. Santral, IVR (Interactive Voice Response), Yapay Zeka / Akıllı Asistan, Tanıtım Filmi, Advertorial, Infomercial, Otobüs, Uçak, Metro, ATM, vb. mecralar için yapılacak seslendirme çalışmalarında işin mahiyetine, uzunluğuna ve kullanım alanına ve kullanım süresine göre fiyatlandırma yapılmaktadır。</p>
        <br><br>
        <p><strong>SUNDU & SUNAR:</strong></p>
        <p>Program giriş-çıkışlarında kullanılan “Sundu-Sunar”, “Separatör”, “Jenerik” ve “Katkılarıyla” olarak adlandırılan spotlar her program/kanal özelinde 2 kaşe (%200) üzerinden hesaplanır. Reklamın yayınlanmasından sonra ayrıca separatör, jenerik, vs. olarak kullanılıyorsa ayrıca tam kaşe (%100) olarak fatura edilir. “Sundu-Sunar” spotlarına eklenecek “Devam Ediyor, Devam Edecek” spotlarının her biri için yarım kaşe (%50), toplam 1 kaşe (%100) daha ayrıca hesaplanır。</p>
    </div>

    <script>
        let anaFilmMecralari = [];
        let versiyonlar = [];
        let versiyonSayisi = 0;
        let currentVersiyonIndex = 0;
        let hasAllTvDijitalSm = false;
        let hasAllIndoorOutdoorMetaverse = false;
        let anaFilmAdiGlobal = "";
        let anaFilmSureGlobal = "";
        let versiyonYokSecildi = false;
        let addedMecras = new Set();
        let archiveCount = 0;

        document.querySelectorAll("input").forEach(input => {
            input.addEventListener("keydown", (e) => {
                if (e.key === "Tab") {
                    e.preventDefault();
                    const inputs = Array.from(document.querySelectorAll("input"));
                    const currentIndex = inputs.indexOf(e.target);
                    const nextIndex = (currentIndex + 1) % inputs.length;
                    inputs[nextIndex].focus();
                }
            });
        });

        document.querySelectorAll("#anaFilmMecraOptions .mecra-button").forEach(button => {
            button.addEventListener("click", () => {
                if (!button.disabled) {
                    button.classList.toggle("selected");
                }
            });
        });

        function showAlert(message) {
            const alertBox = document.getElementById("alertBox");
            alertBox.innerHTML = message;
            alertBox.classList.remove("hidden");
            setTimeout(() => {
                hideAlert();
            }, 1500);
        }

        function hideAlert() {
            document.getElementById("alertBox").classList.add("hidden");
        }

        function handleAnaFilmMecraSelection() {
            anaFilmMecralari = [];
            document.querySelectorAll("#anaFilmMecraOptions .mecra-button.selected").forEach(button => {
                anaFilmMecralari.push(button.getAttribute("data-value"));
            });

            anaFilmAdiGlobal = document.getElementById("anaFilmAdi").value.trim();
            anaFilmSureGlobal = document.getElementById("anaFilmSure").value.trim();

            if (anaFilmMecralari.length > 0) {
                if (anaFilmMecralari.length === 9) {
                    anaFilmMecralari = ["Tüm Mecralar"];
                }

                hasAllTvDijitalSm = anaFilmMecralari.includes("tv") && 
                                   anaFilmMecralari.includes("dijital") && 
                                   anaFilmMecralari.includes("sm") || 
                                   anaFilmMecralari.includes("Tüm Mecralar");

                hasAllIndoorOutdoorMetaverse = anaFilmMecralari.includes("indoor") && 
                                              anaFilmMecralari.includes("outdoor") && 
                                              anaFilmMecralari.includes("metaverse") || 
                                              anaFilmMecralari.includes("Tüm Mecralar");

                document.getElementById("versiyonSection").classList.remove("hidden");
                document.querySelector(".section").classList.add("hidden");
                document.getElementById("geriButton").classList.add("hidden");
                updateSummary(); // Özet hemen eklensin
                showAlert("Ana Film hesaplandı。");
            } else {
                alert("Lütfen en az bir mecra seçin。");
            }
        }

        function showVersiyonMecraOptions() {
            versiyonSayisi = parseInt(document.getElementById("versiyonSayisi").value) || 0;

            if (versiyonSayisi > 0 && versiyonSayisi <= 20) {
                document.getElementById("versiyonSection").classList.add("hidden");
                document.getElementById("versiyonMecraSection").classList.remove("hidden");
                currentVersiyonIndex = 0;
                document.getElementById("versiyonEkleButton").disabled = false; // Versiyon ekleme butonu aktif
                showNextVersiyon();
            } else {
                alert("Lütfen 1 ile 20 arasında bir sayı girin。");
            }
        }

        function skipVersiyon() {
            versiyonYokSecildi = true;
            document.getElementById("versiyonSection").classList.add("hidden");
            document.getElementById("kopyalaButton").classList.remove("hidden");
            document.getElementById("finalActions").classList.remove("hidden");
            document.getElementById("summaryBox").scrollIntoView({ behavior: "smooth" });
            updateSummary();
        }

        function showNextVersiyon() {
            if (currentVersiyonIndex < versiyonSayisi) {
                document.getElementById("versiyonBaslik").innerText = `${currentVersiyonIndex + 1}. Versiyon için Mecraları Seçiniz`;
                document.getElementById("versiyonMecraOptions").innerHTML = `
                    <div class="mecra-button" data-value="tv">TV</div>
                    <div class="mecra-button" data-value="dijital">Dijital</div>
                    <div class="mecra-button" data-value="sm">Sosyal Medya</div>
                    <div class="mecra-button" data-value="karasal_radyo">Karasal Radyo</div>
                    <div class="mecra-button" data-value="dijital_radyo">Dijital Radyo</div>
                    <div class="mecra-button" data-value="sinema">Sinema</div>
                    <div class="mecra-button" data-value="indoor">Indoor</div>
                    <div class="mecra-button" data-value="outdoor">Outdoor</div>
                    <div class="mecra-button" data-value="metaverse">Metaverse</div>
                `;

                document.querySelectorAll("#versiyonMecraOptions .mecra-button").forEach(button => {
                    button.addEventListener("click", () => {
                        if (!button.disabled) {
                            button.classList.toggle("selected");
                        }
                    });
                });

                document.getElementById("versiyonAdi").classList.remove("hidden");
                document.getElementById("versiyonSure").classList.remove("hidden");
                if (currentVersiyonIndex < versiyonlar.length) {
                    document.getElementById("versiyonAdi").value = versiyonlar[currentVersiyonIndex].adi || "";
                    document.getElementById("versiyonSure").value = versiyonlar[currentVersiyonIndex].sure || "";
                } else {
                    document.getElementById("versiyonAdi").value = "";
                    document.getElementById("versiyonSure").value = "";
                }
                document.getElementById("versiyonEkleButton").innerText = `${currentVersiyonIndex + 1}. Versiyonu Ekle`;
            }
        }

        function addVersiyon() {
            let selectedOptions = document.querySelectorAll("#versiyonMecraOptions .mecra-button.selected");
            let versiyonMecralari = Array.from(selectedOptions).map(option => option.getAttribute("data-value"));

            const versiyonAdi = document.getElementById("versiyonAdi").value.trim();
            const versiyonSure = document.getElementById("versiyonSure").value.trim();

            if (versiyonMecralari.length > 0) {
                let versiyonKaşe = 0;
                let extraMecras = [];

                versiyonMecralari.forEach(mecra => {
                    const isInAnaFilm = anaFilmMecralari.includes(mecra) || anaFilmMecralari.includes("Tüm Mecralar");
                    const isAlreadyAdded = addedMecras.has(mecra);
                    const isSpecialMecra = ["tv", "dijital", "sm", "indoor", "outdoor", "metaverse"].includes(mecra);

                    if (isSpecialMecra && !isInAnaFilm && !isAlreadyAdded) {
                        addedMecras.add(mecra);
                        extraMecras.push(mecra);
                        versiyonKaşe += getMecraKase(mecra);
                    } else {
                        versiyonKaşe += (mecra === "indoor" || mecra === "outdoor") ? 1 : 0.5;
                    }
                });

                if (extraMecras.length > 0) {
                    showAlert(`İlk yayın için "${extraMecras.join(", ")}" mecrası/mecraları tam kaşeden hesaplanır。`);
                }

                if (currentVersiyonIndex < versiyonlar.length) {
                    versiyonlar[currentVersiyonIndex] = { mecra: versiyonMecralari, kaşe: versiyonKaşe, adi: versiyonAdi, sure: versiyonSure, extraMecras: extraMecras };
                } else {
                    versiyonlar.push({ mecra: versiyonMecralari, kaşe: versiyonKaşe, adi: versiyonAdi, sure: versiyonSure, extraMecras: extraMecras });
                }

                document.getElementById("versiyonAdi").value = "";
                document.getElementById("versiyonSure").value = "";
                document.getElementById("versiyonAdi").classList.add("hidden");
                document.getElementById("versiyonSure").classList.add("hidden");

                currentVersiyonIndex++;
                updateSummary();

                if (currentVersiyonIndex < versiyonSayisi) {
                    showAlert(`${currentVersiyonIndex}. Versiyon eklendi`);
                    showNextVersiyon();
                } else {
                    document.getElementById("versiyonEkleButton").disabled = true;
                    document.getElementById("kopyalaButton").classList.remove("hidden");
                    document.getElementById("versiyonMecraSection").classList.add("hidden");
                    document.getElementById("finalActions").classList.remove("hidden");
                    document.getElementById("summaryBox").scrollIntoView({ behavior: "smooth" });
                    showAlert("Tüm versiyonlar eklendi, hesaplama özeti yukarıdadır。");
                }
            } else {
                alert("Lütfen en az bir mecra seçin。");
            }
        }

        function geriAl() {
            if (versiyonlar.length > 0) {
                const lastVersiyon = versiyonlar.pop();
                if (lastVersiyon.extraMecras && lastVersiyon.extraMecras.length > 0) {
                    lastVersiyon.extraMecras.forEach(mecra => {
                        if (!versiyonlar.some(v => v.mecra.includes(mecra))) {
                            addedMecras.delete(mecra);
                        }
                    });
                }
                currentVersiyonIndex--;
                updateSummary();
                document.getElementById("versiyonEkleButton").disabled = false;

                if (versiyonlar.length > 0) {
                    currentVersiyonIndex = Math.max(0, currentVersiyonIndex);
                    showNextVersiyon();
                } else {
                    document.getElementById("versiyonSection").classList.remove("hidden");
                    document.getElementById("versiyonMecraSection").classList.add("hidden");
                    document.getElementById("devamEtButton").disabled = false;
                    document.getElementById("versiyonYokButton").classList.remove("hidden");
                    document.getElementById("versiyonSayisi").value = versiyonSayisi;
                    document.getElementById("finalActions").classList.add("hidden");
                }
            } else if (anaFilmMecralari.length > 0) {
                anaFilmMecralari = [];
                hasAllTvDijitalSm = false;
                hasAllIndoorOutdoorMetaverse = false;
                document.getElementById("versiyonSection").classList.add("hidden");
                document.getElementById("versiyonMecraSection").classList.add("hidden");
                document.getElementById("anaFilmOnaylaButton").classList.remove("hidden");
                document.getElementById("anaFilmMecraOptions").classList.remove("hidden");
                document.getElementById("anaFilmAdi").classList.remove("hidden");
                document.getElementById("anaFilmSure").classList.remove("hidden");
                document.querySelector("label[for='anaFilmAdi']").classList.remove("hidden");
                document.querySelector("label[for='anaFilmMecraOptions']").classList.remove("hidden");
                document.querySelectorAll("#anaFilmMecraOptions .mecra-button").forEach(button => {
                    button.disabled = false;
                });
                addedMecras.clear();
                updateSummary();
                document.getElementById("finalActions").classList.add("hidden");
            } else {
                alert("Geri alınacak bir işlem yok。");
            }
        }

        function resetAll() {
            anaFilmMecralari = [];
            versiyonlar = [];
            versiyonSayisi = 0;
            currentVersiyonIndex = 0;
            hasAllTvDijitalSm = false;
            hasAllIndoorOutdoorMetaverse = false;
            versiyonYokSecildi = false;
            addedMecras.clear();
            anaFilmAdiGlobal = "";
            anaFilmSureGlobal = "";
            archiveCount = 0;
            document.getElementById("versiyonSection").classList.add("hidden");
            document.getElementById("versiyonMecraSection").classList.add("hidden");
            document.getElementById("geriButton").classList.add("hidden");
            document.getElementById("kopyalaButton").classList.add("hidden");
            document.getElementById("anaFilmOnaylaButton").classList.remove("hidden");
            document.getElementById("anaFilmMecraOptions").classList.remove("hidden");
            document.getElementById("anaFilmAdi").classList.remove("hidden");
            document.getElementById("anaFilmSure").classList.remove("hidden");
            document.querySelector("label[for='anaFilmAdi']").classList.remove("hidden");
            document.querySelector("label[for='anaFilmMecraOptions']").classList.remove("hidden");
            document.querySelector(".section").classList.remove("hidden");
            document.getElementById("selectionContainer").classList.remove("hidden");
            document.getElementById("devamEtButton").disabled = false;
            document.getElementById("versiyonEkleButton").disabled = false;
            document.getElementById("versiyonYokButton").classList.remove("hidden");
            document.getElementById("finalActions").classList.add("hidden");
            document.getElementById("restartSection").classList.add("hidden");
            document.getElementById("summaryText").innerHTML = "";
            document.getElementById("archiveEntries").innerHTML = "";
            document.getElementById("anaFilmAdi").value = "";
            document.getElementById("anaFilmSure").value = "";
            document.querySelectorAll("#anaFilmMecraOptions .mecra-button.selected").forEach(button => {
                button.classList.remove("selected");
            });
            document.querySelectorAll("#anaFilmMecraOptions .mecra-button").forEach(button => {
                button.disabled = false;
            });
        }

        function archiveAndReset() {
            const summaryText = document.getElementById("summaryText").innerText;
            archiveCount++;
            const archiveEntries = document.getElementById("archiveEntries");
            const entryDiv = document.createElement("div");
            entryDiv.classList.add("archive-entry");
            entryDiv.innerHTML = `<strong>Hesaplama (${archiveCount}):</strong><br>${summaryText.replace(/\n/g, "<br>")}`;
            archiveEntries.appendChild(entryDiv);
            document.getElementById("summaryText").innerHTML = ""; // Özet kısmı temizlensin
            document.getElementById("finalActions").classList.add("hidden"); // Butonlar kalksın
            document.getElementById("selectionContainer").classList.remove("hidden"); // Seçim ekranı geri gelsin
            document.querySelector(".section").classList.remove("hidden"); // Ana film seçimi geri gelsin
            resetForNewCalculation();
        }

        function finishCalculation() {
            const summaryText = document.getElementById("summaryText").innerText;
            archiveCount++;
            const archiveEntries = document.getElementById("archiveEntries");
            const entryDiv = document.createElement("div");
            entryDiv.classList.add("archive-entry");
            entryDiv.innerHTML = `<strong>Hesaplama (${archiveCount}):</strong><br>${summaryText.replace(/\n/g, "<br>")}`;
            archiveEntries.appendChild(entryDiv);
            document.getElementById("selectionContainer").classList.add("hidden");
            document.getElementById("kopyalaButton").classList.remove("hidden");
            document.getElementById("restartSection").classList.remove("hidden");
            document.getElementById("summaryText").innerHTML = ""; // Renkli özet kalksın
            document.getElementById("summaryBox").scrollIntoView({ behavior: "smooth" });
        }

        function resetForNewCalculation() {
            anaFilmMecralari = [];
            versiyonlar = [];
            versiyonSayisi = 0;
            currentVersiyonIndex = 0;
            hasAllTvDijitalSm = false;
            hasAllIndoorOutdoorMetaverse = false;
            versiyonYokSecildi = false;
            addedMecras.clear();
            anaFilmAdiGlobal = "";
            anaFilmSureGlobal = "";
            document.getElementById("anaFilmAdi").value = "";
            document.getElementById("anaFilmSure").value = "";
            document.getElementById("versiyonEkleButton").disabled = false; // Versiyon ekleme butonu aktif
            document.querySelectorAll("#anaFilmMecraOptions .mecra-button.selected").forEach(button => {
                button.classList.remove("selected");
            });
            document.querySelectorAll("#anaFilmMecraOptions .mecra-button").forEach(button => {
                button.disabled = false;
            });
        }

        function kopyalaOzet() {
            let archiveText = Array.from(document.querySelectorAll(".archive-entry")).map(entry => entry.innerText).join("\n\n");
            navigator.clipboard.writeText(archiveText).then(() => {
                alert("Özet kopyalandı!");
            });
        }

        function getMecraKase(value) {
            switch (value) {
                case "tv":
                case "dijital":
                case "sm":
                    return 1;
                case "karasal_radyo":
                case "dijital_radyo":
                case "sinema":
                    return anaFilmMecralari.some(m => ["tv", "dijital", "sm"].includes(m)) ? 0.5 : 1;
                case "indoor":
                case "outdoor":
                case "metaverse":
                    return 2;
                default:
                    return 0;
            }
        }

        function updateSummary() {
            let anaFilmKaşe = calculateMecraKaşe(anaFilmMecralari);
            let versiyonKaşe = versiyonlar.reduce((sum, versiyon) => sum + versiyon.kaşe, 0);
            let toplamKaşe = anaFilmKaşe + versiyonKaşe;

            const anaFilmMecralariFormatted = anaFilmMecralari.map(mecra => {
                if (mecra === "Tüm Mecralar") return mecra;
                const kase = getMecraKase(mecra);
                return `${mecra} (${kase} kaşe)`;
            }).join(", ");

            const anaFilmBilgi = anaFilmAdiGlobal || anaFilmSureGlobal ? 
                `${anaFilmAdiGlobal || "Ad Belirtilmedi"} / ${anaFilmSureGlobal ? anaFilmSureGlobal + " sn" : "Süre Belirtilmedi"}` : "Ad Belirtilmedi / Süre Belirtilmedi";

            const versiyonlarFormatted = versiyonlar.map((versiyon, index) => {
                const mecralarFormatted = versiyon.mecra.map(mecra => {
                    const isExtra = versiyon.extraMecras && versiyon.extraMecras.includes(mecra);
                    const kase = isExtra ? getMecraKase(mecra) : (mecra === "indoor" || mecra === "outdoor" ? 1 : 0.5);
                    return isExtra ? `<span class="extra-mecra">${mecra} (${kase} kaşe)</span>` : `${mecra} (${kase} kaşe)`;
                }).join(", ");
                const versiyonBilgi = versiyon.adi || versiyon.sure ? 
                    `${versiyon.adi || "Ad Belirtilmedi"} / ${versiyon.sure ? versiyon.sure + " sn" : "Süre Belirtilmedi"}` : "Ad Belirtilmedi / Süre Belirtilmedi";
                return `<strong>- Versiyon ${index + 1}</strong> [${versiyonBilgi}]: ${mecralarFormatted} <strong>(Toplam: ${versiyon.kaşe} kaşe)</strong>`;
            }).join("<br>");

            let summaryText = "";
            if (anaFilmMecralari.length > 0) {
                summaryText += `
                    <div class="ana-film-summary">
                        <strong>Ana Film</strong> [${anaFilmBilgi}]:<br>
                        - <strong>Mecralar</strong>: ${anaFilmMecralariFormatted}<br>
                        - <strong>Ana Film için Toplam Kaşe</strong>: ${anaFilmKaşe} kaşe<br>
                    </div>
                `;
            }

            if (!versiyonYokSecildi && versiyonlar.length > 0) {
                summaryText += `
                    <br>
                    <div class="versiyon-summary">
                        <strong>Versiyonlar:</strong><br>
                        ${versiyonlarFormatted}<br>
                        <br>
                        <strong>Versiyonlar için Toplam Kaşe:</strong> ${versiyonKaşe} kaşe<br>
                    </div>
                `;
            }

            if (anaFilmMecralari.length > 0 && versiyonlar.length > 0) {
                summaryText += `
                    <br>
                    <strong class="toplam-kase">Toplam Kaşe: ${toplamKaşe} kaşe。</strong>
                `;
            }

            document.getElementById("summaryText").innerHTML = summaryText;
        }

        function calculateMecraKaşe(mecralar) {
            if (mecralar.includes("Tüm Mecralar")) {
                return 7;
            }

            let kaşe = 0;
            let radyoSinemaCount = 0;

            let hasTvDijitalSmLocal = mecralar.some(mecra => ["tv", "dijital", "sm"].includes(mecra));

            mecralar.forEach(mecra => {
                switch (mecra) {
                    case "tv":
                    case "dijital":
                    case "sm":
                        kaşe += 1;
                        break;
                    case "karasal_radyo":
                    case "dijital_radyo":
                    case "sinema":
                        if (hasTvDijitalSmLocal) {
                            kaşe += 0.5;
                        } else {
                            radyoSinemaCount++;
                            if (radyoSinemaCount === 1) {
                                kaşe += 1;
                            } else {
                                kaşe += 0.5;
                            }
                        }
                        break;
                    case "indoor":
                    case "outdoor":
                    case "metaverse":
                        kaşe += 2;
                        break;
                }
            });

            return kaşe;
        }
    </script>
</body>
</html>
